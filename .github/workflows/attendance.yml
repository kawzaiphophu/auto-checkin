name: HR Attendance

on:
  schedule:
    # รันทุกวันเวลา 9:00 น. (UTC+7 = 02:00 UTC)
    - cron: '0 2 * * *'
  workflow_dispatch: # อนุญาตให้รันด้วยตนเองได้

jobs:
  attendance:
    runs-on: ubuntu-latest
    container:
      image: mcr.microsoft.com/playwright/python:v1.41.0-jammy
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Install dependencies
        run: |
          pip install playwright==1.41.0 --no-deps
        env:
          PLAYWRIGHT_SKIP_BROWSER_DOWNLOAD: 1
      
      - name: Run attendance script
        env:
          HR_TOKEN: ${{ secrets.HR_TOKEN }}
        run: |
          python hr_attendance.py
      
      - name: Report success
        if: success()
        run: |
          echo "✅ Attendance check-in completed successfully at $(date)"
      
      - name: Upload logs if failed
        if: failure()
        uses: actions/upload-artifact@v4
        with:
          name: attendance-logs
          path: |
            *.log
          retention-days: 7
